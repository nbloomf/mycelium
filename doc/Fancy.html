<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Fancy Proofs</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Fancy Proofs</h1>
</header>
<p>A natural deduction proof is a tree. In practice, reading and writing proof trees has some drawbacks. When proofs reach a certain size it can be difficult to lay out a tree-formatted proof on the page. Also, trees aren’t a great fit for the way we usually read text from beginning to end.</p>
<p>There’s an alternative syntax for natural deduction, which is basically a depth-first serialization of the proof tree. For instance, the tree</p>
<pre><code>* A
  * B
    * C
  * D
    * E
      * F
    * G</code></pre>
<p>might be serialized as</p>
<pre><code>1. C;
2. B; 1
3. F;
4. E; 3
5. G;
6. D; 4, 5
7. A; 2, 6</code></pre>
<p>In other words, write the nodes of the tree as a numbered list, where each node is accompanied by a list of references to its children. There are many valid ways to serialize a tree, but a valid serialization represents a unique tree.</p>
<p>This is almost <a href="https://en.wikipedia.org/wiki/Fitch_notation">Fitch notation</a>, with one exception – because a serialized proof represents a unique tree, it isn’t necessary to use indentation to signify what hypotheses have been introduced but not discharged. (It’s a good idea to do this anyway for human readers, but the proof checker doesn’t need it.)</p>
<p>The serialized syntax has some advantages. It doesn’t require arbitrary indentation – which is a big problem for large proofs. It is more natural to read from top to bottom. And it facilitates writing shorter proofs when a subproof appears more than once, although this is not very common.</p>
<p>In this module we’ll define an alternative abstract syntax for serialized proofs, which we’ll call <em>fancy style</em>.</p>
<p>As usual we start with imports.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">{-# LANGUAGE LambdaCase #-}</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">module</span> <span class="dt">Fancy</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Data.List</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Test.QuickCheck</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Var</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Sub</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">import</span> <span class="dt">Expr</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw">import</span> <span class="dt">Jud</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">import</span> <span class="dt">Proof</span></a></code></pre></div>
<h2 id="the-representation">The Representation</h2>
<p>Where a proof is a tree of proofs, a fancy proof is a list of proof statements.</p>
<p>Fancy proof statements will look suspiciously like the nodes in a nonfancy proof, except that <em>subproofs</em> will be replaced by <em>references</em>. The lines in a fancy proof are usually numbered, so the references can just be <code>Int</code>s.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">data</span> <span class="dt">FancyProof</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="fu">=</span> <span class="dt">FancyProof</span> (<span class="dt">M.Map</span> <span class="dt">Int</span> <span class="dt">FancyProofLine</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">data</span> <span class="dt">FancyProofLine</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="fu">=</span> <span class="dt">FancyUse</span> <span class="dt">Loc</span> <span class="dt">RuleName</span> <span class="dt">Jud</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="fu">|</span> <span class="dt">FancyHyp</span> <span class="dt">Loc</span> <span class="dt">HypName</span> <span class="dt">Jud</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="fu">|</span> <span class="dt">FancyDis</span> <span class="dt">Loc</span> <span class="dt">HypName</span> <span class="dt">Jud</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  <span class="fu">|</span> <span class="dt">FancyElimEq</span> <span class="dt">Loc</span> <span class="dt">Jud</span> (<span class="dt">Var</span> <span class="dt">Expr</span>) <span class="dt">Jud</span> <span class="dt">Int</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  <span class="fu">|</span> <span class="dt">FancyIntroU</span> <span class="dt">Loc</span> <span class="dt">Jud</span> (<span class="dt">Var</span> <span class="dt">Expr</span>) (<span class="dt">Var</span> <span class="dt">Expr</span>) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  <span class="fu">|</span> <span class="dt">FancyElimU</span> <span class="dt">Loc</span> <span class="dt">Jud</span> (<span class="dt">Var</span> <span class="dt">Expr</span>) <span class="dt">Expr</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  <span class="fu">|</span> <span class="dt">FancySubst</span> <span class="dt">Loc</span> <span class="dt">Jud</span> (<span class="dt">Sub</span> <span class="dt">Expr</span>) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  <span class="fu">|</span> <span class="dt">FancyAssume</span> <span class="dt">Loc</span> <span class="dt">Int</span> <span class="dt">Jud</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  <span class="kw">deriving</span> (<span class="dt">Show</span>)</a></code></pre></div>
<p>For testing we’ll need an <code>Eq</code> instance for <code>FancyProofLine</code> that ignores the <code>Loc</code> parameters.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Eq</span> <span class="dt">FancyProofLine</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  l1 <span class="fu">==</span> l2 <span class="fu">=</span> <span class="kw">case</span> (l1,l2) <span class="kw">of</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    (<span class="dt">FancyUse</span> _ n1 q1 ps1, <span class="dt">FancyUse</span> _ n2 q2 ps2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">      (n1 <span class="fu">==</span> n2) <span class="fu">&amp;&amp;</span> (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (ps1 <span class="fu">==</span> ps2)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    (<span class="dt">FancyHyp</span> _ n1 q1, <span class="dt">FancyHyp</span> _ n2 q2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">      (n1 <span class="fu">==</span> n2) <span class="fu">&amp;&amp;</span> (q1 <span class="fu">==</span> q2)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    (<span class="dt">FancyDis</span> _ n1 q1 p1, <span class="dt">FancyDis</span> _ n2 q2 p2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">      (n1 <span class="fu">==</span> n2) <span class="fu">&amp;&amp;</span> (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (p1 <span class="fu">==</span> p2)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    (<span class="dt">FancyElimEq</span> _ q1 x1 w1 u1 v1, <span class="dt">FancyElimEq</span> _ q2 x2 w2 u2 v2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">      (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (x1 <span class="fu">==</span> x2) <span class="fu">&amp;&amp;</span> (w1 <span class="fu">==</span> w1) <span class="fu">&amp;&amp;</span> (u1 <span class="fu">==</span> u2) <span class="fu">&amp;&amp;</span> (v1 <span class="fu">==</span> v2)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    (<span class="dt">FancyIntroU</span> _ q1 x1 y1 p1, <span class="dt">FancyIntroU</span> _ q2 x2 y2 p2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">      (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (x1 <span class="fu">==</span> x2) <span class="fu">&amp;&amp;</span> (y1 <span class="fu">==</span> y2) <span class="fu">&amp;&amp;</span> (p1 <span class="fu">==</span> p2)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    (<span class="dt">FancyElimU</span> _ q1 x1 e1 p1, <span class="dt">FancyElimU</span> _ q2 x2 e2 p2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">      (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (x1 <span class="fu">==</span> x2) <span class="fu">&amp;&amp;</span> (e1 <span class="fu">==</span> e2) <span class="fu">&amp;&amp;</span> (p1 <span class="fu">==</span> p2)</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">    (<span class="dt">FancySubst</span> _ q1 s1 p1, <span class="dt">FancySubst</span> _ q2 s2 p2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16">      (q1 <span class="fu">==</span> q2) <span class="fu">&amp;&amp;</span> (s1 <span class="fu">==</span> s2) <span class="fu">&amp;&amp;</span> (p1 <span class="fu">==</span> p2)</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    (<span class="dt">FancyAssume</span> _ n1 q1, <span class="dt">FancyAssume</span> _ n2 q2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">      (n1 <span class="fu">==</span> n2) <span class="fu">&amp;&amp;</span> (q1 <span class="fu">==</span> q2)</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a></code></pre></div>
<p>For funsies, here’s an <code>Arbitrary</code> instance.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arbitrary</span> <span class="dt">FancyProofLine</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  arbitrary <span class="fu">=</span> oneof</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    [ <span class="dt">FancyUse</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">        <span class="fu">&lt;*&gt;</span> ((map abs) <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    , <span class="dt">FancyHyp</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    , <span class="dt">FancyDis</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">        <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    , <span class="dt">FancyElimEq</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">        <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary) <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    , <span class="dt">FancyIntroU</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">        <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    , <span class="dt">FancyElimU</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">    , <span class="dt">FancySubst</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">        <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary)</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">    , <span class="dt">FancyAssume</span> <span class="fu">&lt;$&gt;</span> arbitrary <span class="fu">&lt;*&gt;</span> (abs <span class="fu">&lt;$&gt;</span> arbitrary) <span class="fu">&lt;*&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    ]</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">  shrink <span class="fu">=</span> \<span class="kw">case</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20">    <span class="dt">FancyUse</span> loc name q ps <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">      [ <span class="dt">FancyUse</span> loc name q&#39; ps <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="dt">FancyHyp</span> loc name q <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">      [ <span class="dt">FancyHyp</span> loc name q&#39; <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">    <span class="dt">FancyDis</span> loc name q p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">      [ <span class="dt">FancyDis</span> loc name q&#39; p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">    <span class="dt">FancyElimEq</span> loc q x w pe pf <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27">      [ <span class="dt">FancyElimEq</span> loc q&#39; x w&#39; pe pf <span class="fu">|</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">          q&#39; <span class="ot">&lt;-</span> shrink q, w&#39; <span class="ot">&lt;-</span> shrink w ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29">      [ <span class="dt">FancyElimEq</span> loc q x w&#39; pe pf <span class="fu">|</span> w&#39; <span class="ot">&lt;-</span> shrink w ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30">      [ <span class="dt">FancyElimEq</span> loc q&#39; x w pe pf <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">    <span class="dt">FancyIntroU</span> loc q x y p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">      [ <span class="dt">FancyIntroU</span> loc q&#39; x y p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">    <span class="dt">FancyElimU</span> loc q x e p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34">      [ <span class="dt">FancyElimU</span> loc q&#39; x e&#39; p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q, e&#39; <span class="ot">&lt;-</span> shrink e ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35">      [ <span class="dt">FancyElimU</span> loc q&#39; x e p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36">      [ <span class="dt">FancyElimU</span> loc q x e&#39; p <span class="fu">|</span> e&#39; <span class="ot">&lt;-</span> shrink e ]</a>
<a class="sourceLine" id="cb6-37" data-line-number="37">    <span class="dt">FancySubst</span> loc q s p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38">      [ <span class="dt">FancySubst</span> loc q&#39; s&#39; p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q, s&#39; <span class="ot">&lt;-</span> shrink s ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39">      [ <span class="dt">FancySubst</span> loc q&#39; s p <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ] <span class="fu">++</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40">      [ <span class="dt">FancySubst</span> loc q s&#39; p <span class="fu">|</span> s&#39; <span class="ot">&lt;-</span> shrink s ]</a>
<a class="sourceLine" id="cb6-41" data-line-number="41">    <span class="dt">FancyAssume</span> loc t q <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42">      [ <span class="dt">FancyAssume</span> loc t q&#39; <span class="fu">|</span> q&#39; <span class="ot">&lt;-</span> shrink q ]</a>
<a class="sourceLine" id="cb6-43" data-line-number="43"></a>
<a class="sourceLine" id="cb6-44" data-line-number="44"><span class="kw">instance</span> <span class="dt">Arbitrary</span> <span class="dt">FancyProof</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45">  arbitrary <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-46" data-line-number="46">    m <span class="ot">&lt;-</span> M.mapKeys abs <span class="fu">&lt;$&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-47" data-line-number="47">    k <span class="ot">&lt;-</span> abs <span class="fu">&lt;$&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb6-48" data-line-number="48">    a <span class="ot">&lt;-</span> arbitrary</a>
<a class="sourceLine" id="cb6-49" data-line-number="49">    return <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.insert k a m</a>
<a class="sourceLine" id="cb6-50" data-line-number="50"></a>
<a class="sourceLine" id="cb6-51" data-line-number="51">  shrink (<span class="dt">FancyProof</span> m) <span class="fu">=</span> map <span class="dt">FancyProof</span> <span class="fu">$</span> shrink m</a></code></pre></div>
<p>We will not directly validate fancy proofs – instead we will convert them to their canonical nonfancy form and validate that. The fancy form is just an alternative abstract (and later, concrete) syntax.</p>
<p>Deserialization of a fancy proof can fail in a few ways; we might have a reference to a nonexistent proof step. We might have a reference from an early step to a later step; to ensure that deserialization terminates this should not be allowed. Also we will demand that the step labels be natural numbers.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">data</span> <span class="dt">DeserializeError</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="fu">=</span> <span class="dt">StepNotPresent</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="fu">|</span> <span class="dt">NegativeRef</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="fu">|</span> <span class="dt">ForwardRef</span> <span class="dt">Int</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  <span class="fu">|</span> <span class="dt">EmptyProof</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<p>To deserialize, we construct the tree proof from the leaves to the root.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ot">deserialize ::</span> <span class="dt">FancyProof</span> <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">DeserializeError</span> <span class="dt">Proof</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">deserialize (<span class="dt">FancyProof</span> m) <span class="fu">=</span> <span class="kw">case</span> M.lookupMax m <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Left</span> <span class="dt">EmptyProof</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="dt">Just</span> (t,_) <span class="ot">-&gt;</span> deserializeAt t</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    deserializeAt k <span class="fu">=</span> <span class="kw">if</span> k <span class="fu">&lt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">      <span class="kw">then</span> <span class="dt">Left</span> <span class="fu">$</span> <span class="dt">NegativeRef</span> k</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">      <span class="kw">else</span> <span class="kw">case</span> M.lookup k m <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Left</span> <span class="fu">$</span> <span class="dt">StepNotPresent</span> k</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">        <span class="dt">Just</span> t <span class="ot">-&gt;</span> <span class="kw">case</span> t <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">          <span class="dt">FancyHyp</span> loc name q <span class="ot">-&gt;</span> <span class="dt">Right</span> <span class="fu">$</span> <span class="dt">Hyp</span> loc name q</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">          <span class="dt">FancyDis</span> loc name q u <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">            p <span class="ot">&lt;-</span> deserializeBelowAt k u</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">            return <span class="fu">$</span> <span class="dt">Dis</span> loc name q p</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">          <span class="dt">FancyElimEq</span> loc q x e u v <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">            pu <span class="ot">&lt;-</span> deserializeBelowAt k u</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">            pv <span class="ot">&lt;-</span> deserializeBelowAt k v</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">            return <span class="fu">$</span> <span class="dt">ElimEq</span> loc q x e pu pv</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">          <span class="dt">FancyIntroU</span> loc q x y u <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20">            p <span class="ot">&lt;-</span> deserializeBelowAt k u</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">            return <span class="fu">$</span> <span class="dt">IntroU</span> loc q x y p</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">          <span class="dt">FancyElimU</span> loc q x e u <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23">            p <span class="ot">&lt;-</span> deserializeBelowAt k u</a>
<a class="sourceLine" id="cb8-24" data-line-number="24">            return <span class="fu">$</span> <span class="dt">ElimU</span> loc q x e p</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">          <span class="dt">FancySubst</span> loc q s u <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26">            p <span class="ot">&lt;-</span> deserializeBelowAt k u</a>
<a class="sourceLine" id="cb8-27" data-line-number="27">            return <span class="fu">$</span> <span class="dt">Subst</span> loc q s p</a>
<a class="sourceLine" id="cb8-28" data-line-number="28">          <span class="dt">FancyAssume</span> loc t q <span class="ot">-&gt;</span> <span class="dt">Right</span> <span class="fu">$</span> <span class="dt">Assume</span> loc t q</a>
<a class="sourceLine" id="cb8-29" data-line-number="29">          <span class="dt">FancyUse</span> loc name q us <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30">            ps <span class="ot">&lt;-</span> mapM (deserializeBelowAt k) us</a>
<a class="sourceLine" id="cb8-31" data-line-number="31">            return <span class="fu">$</span> <span class="dt">Use</span> loc name q ps</a>
<a class="sourceLine" id="cb8-32" data-line-number="32"></a>
<a class="sourceLine" id="cb8-33" data-line-number="33">    deserializeBelowAt k u <span class="fu">=</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34">      <span class="kw">if</span> u <span class="fu">&gt;=</span> k</a>
<a class="sourceLine" id="cb8-35" data-line-number="35">        <span class="kw">then</span> <span class="dt">Left</span> <span class="fu">$</span> <span class="dt">ForwardRef</span> u k</a>
<a class="sourceLine" id="cb8-36" data-line-number="36">        <span class="kw">else</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37">          p <span class="ot">&lt;-</span> deserializeAt u</a>
<a class="sourceLine" id="cb8-38" data-line-number="38">          return p</a></code></pre></div>
<h2 id="serialization">Serialization</h2>
<p>In practice there isn’t really a good reason to turn a nonfancy proof into a fancy proof, since the most important thing we do with proofs is validate them.</p>
<p>But a good test of our deserialization function is that deserializing a serialized nonfancy proof should be the identity. In the spirit of overdoing it, lets write that test.</p>
<p>In the following code, we’ll be implicitly assuming that the lines of a proof are numbered contiguously from 1 to <span class="math inline">\(n\)</span>. This won’t be checked, since this is just test code which should break if that invariant is not satisfied. This constraint is not necessary when we actually use the library, but makes the test much simpler.</p>
<p>We need a couple of utilities. First is <code>catFancyProof</code>, which concatenates two fancy proofs and updates the line labels in the second.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="ot">catFancyProof ::</span> <span class="dt">FancyProof</span> <span class="ot">-&gt;</span> <span class="dt">FancyProof</span> <span class="ot">-&gt;</span> <span class="dt">FancyProof</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">catFancyProof p<span class="fu">@</span>(<span class="dt">FancyProof</span> m1) (<span class="dt">FancyProof</span> m2) <span class="fu">=</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="kw">let</span> k <span class="fu">=</span> sizeOf p <span class="kw">in</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">FancyProof</span> <span class="fu">$</span> M.union m1 (fmap (bump k) <span class="fu">$</span> M.mapKeys (k<span class="fu">+</span>) m2)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="ot">    bump ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">FancyProofLine</span> <span class="ot">-&gt;</span> <span class="dt">FancyProofLine</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    bump k <span class="fu">=</span> \<span class="kw">case</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">      <span class="dt">FancyUse</span> loc name q ps <span class="ot">-&gt;</span> <span class="dt">FancyUse</span> loc name q (map (k<span class="fu">+</span>) ps)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">      <span class="dt">FancyHyp</span> loc name q <span class="ot">-&gt;</span> <span class="dt">FancyHyp</span> loc name q</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">      <span class="dt">FancyDis</span> loc name q p <span class="ot">-&gt;</span> <span class="dt">FancyDis</span> loc name q (k<span class="fu">+</span>p)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">      <span class="dt">FancyElimEq</span> loc q x w u v <span class="ot">-&gt;</span> <span class="dt">FancyElimEq</span> loc q x w (k<span class="fu">+</span>u) (k<span class="fu">+</span>v)</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">      <span class="dt">FancyIntroU</span> loc q x y p <span class="ot">-&gt;</span> <span class="dt">FancyIntroU</span> loc q x y (k<span class="fu">+</span>p)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">      <span class="dt">FancyElimU</span> loc q x e p <span class="ot">-&gt;</span> <span class="dt">FancyElimU</span> loc q x e (k<span class="fu">+</span>p)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">      <span class="dt">FancySubst</span> loc q s p <span class="ot">-&gt;</span> <span class="dt">FancySubst</span> loc q s (k<span class="fu">+</span>p)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">      <span class="dt">FancyAssume</span> loc t q <span class="ot">-&gt;</span> <span class="dt">FancyAssume</span> loc t q</a></code></pre></div>
<p>We also need <code>sizeOf</code>, which gets the largest line label of a fancy proof.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="ot">sizeOf ::</span> <span class="dt">FancyProof</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">sizeOf (<span class="dt">FancyProof</span> m) <span class="fu">=</span> <span class="kw">case</span> M.lookupMax m <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="dt">Just</span> (k,_) <span class="ot">-&gt;</span> k</a></code></pre></div>
<p>We’re now prepared to serialize proofs. The result is a <em>list</em> of fancy proofs, because there’s generally more than one way to serialize a proof. We don’t enumerate all of them for simplicity’s sake.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ot">serialize ::</span> <span class="dt">Proof</span> <span class="ot">-&gt;</span> [<span class="dt">FancyProof</span>]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">serialize <span class="fu">=</span> \<span class="kw">case</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">Assume</span> loc k p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    [ <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList [ (<span class="dv">1</span>, <span class="dt">FancyAssume</span> loc k p) ] ]</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">Hyp</span> loc name p <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    [ <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList [ (<span class="dv">1</span>, <span class="dt">FancyHyp</span> loc name p) ] ]</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">Dis</span> loc name q p <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    m <span class="ot">&lt;-</span> serialize p</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="kw">let</span> k <span class="fu">=</span> sizeOf m</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">    [ append m <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">      [ (<span class="dv">1</span>, <span class="dt">FancyDis</span> loc name q k) ] ]</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="dt">ElimEq</span> loc w x q pe pf <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    me <span class="ot">&lt;-</span> serialize pe</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">    mf <span class="ot">&lt;-</span> serialize pf</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">    <span class="kw">let</span> ke <span class="fu">=</span> sizeOf me</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    <span class="kw">let</span> kf <span class="fu">=</span> sizeOf mf</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    [   append (catFancyProof me mf) <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">        [ (<span class="dv">1</span>, <span class="dt">FancyElimEq</span> loc w x q ke (ke<span class="fu">+</span>kf)) ]</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">      , append (catFancyProof mf me) <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">        [ (<span class="dv">1</span>, <span class="dt">FancyElimEq</span> loc w x q (ke<span class="fu">+</span>kf) kf) ]</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">      ]</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">  <span class="dt">Subst</span> loc q s p <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23">    m <span class="ot">&lt;-</span> serialize p</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">    <span class="kw">let</span> k <span class="fu">=</span> sizeOf m</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">    [ append m <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">      [ (<span class="dv">1</span>, <span class="dt">FancySubst</span> loc q s k) ] ]</a>
<a class="sourceLine" id="cb11-27" data-line-number="27">  <span class="dt">IntroU</span> loc w x y p <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28">    m <span class="ot">&lt;-</span> serialize p</a>
<a class="sourceLine" id="cb11-29" data-line-number="29">    <span class="kw">let</span> k <span class="fu">=</span> sizeOf m</a>
<a class="sourceLine" id="cb11-30" data-line-number="30">    [ append m <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-31" data-line-number="31">      [ (<span class="dv">1</span>, <span class="dt">FancyIntroU</span> loc w x y k) ] ]</a>
<a class="sourceLine" id="cb11-32" data-line-number="32">  <span class="dt">ElimU</span> loc w x e p <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33">    m <span class="ot">&lt;-</span> serialize p</a>
<a class="sourceLine" id="cb11-34" data-line-number="34">    <span class="kw">let</span> k <span class="fu">=</span> sizeOf m</a>
<a class="sourceLine" id="cb11-35" data-line-number="35">    [ append m <span class="fu">$</span> <span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-36" data-line-number="36">      [ (<span class="dv">1</span>, <span class="dt">FancyElimU</span> loc w x e k) ] ]</a>
<a class="sourceLine" id="cb11-37" data-line-number="37">  <span class="dt">Use</span> loc name q ps <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38">    ms <span class="ot">&lt;-</span> mapM serialize ps</a>
<a class="sourceLine" id="cb11-39" data-line-number="39">    <span class="kw">let</span> ks <span class="fu">=</span> map sizeOf ms</a>
<a class="sourceLine" id="cb11-40" data-line-number="40">    <span class="kw">let</span> accum <span class="fu">=</span> map sum <span class="fu">.</span> tail <span class="fu">.</span> inits</a>
<a class="sourceLine" id="cb11-41" data-line-number="41">    [ append</a>
<a class="sourceLine" id="cb11-42" data-line-number="42">      (foldr catFancyProof (<span class="dt">FancyProof</span> mempty) ms)</a>
<a class="sourceLine" id="cb11-43" data-line-number="43">        (<span class="dt">FancyProof</span> <span class="fu">$</span> M.fromList</a>
<a class="sourceLine" id="cb11-44" data-line-number="44">          [ (<span class="dv">1</span>, <span class="dt">FancyUse</span> loc name q (accum ks)) ]) ]</a>
<a class="sourceLine" id="cb11-45" data-line-number="45"></a>
<a class="sourceLine" id="cb11-46" data-line-number="46">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47">    append p<span class="fu">@</span>(<span class="dt">FancyProof</span> m1) (<span class="dt">FancyProof</span> m2) <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48">      <span class="kw">let</span> k <span class="fu">=</span> sizeOf p <span class="kw">in</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49">      <span class="dt">FancyProof</span> <span class="fu">$</span> M.union m1 (M.mapKeys (k<span class="fu">+</span>) m2)</a></code></pre></div>
<p>And we can test that deserializing a serialized proof returns the same proof. Going in the other direction is less straightforward, since fancy proofs are subject to syntactic validation.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="ot">test_deserialize ::</span> <span class="dt">Proof</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">test_deserialize p <span class="fu">=</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  and [ <span class="dt">Right</span> p <span class="fu">==</span> deserialize q <span class="fu">|</span> q <span class="ot">&lt;-</span> serialize p ]</a></code></pre></div>
</body>
</html>
